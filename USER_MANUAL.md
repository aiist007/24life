# 倪海厦二十四节气养生历 - 使用手册

本手册旨在指导用户如何使用“倪师 AI 分身”对话系统及节气养生平台，并记录项目的功能版本演进。

---

## 🚀 版本更新日志 (Version History)

### v1.3.0 (2026-01-07) - 时空感知与智能食疗升级
- **[新增] 时空感知系统**：系统现在能自动获取当前日期、星期及二十四节气。
- **[新增] 地域感知**：默认定位为“北京”，并能从用户对话中自动提取提到的城市（如“我在上海...”）。
- **[新增] 智能食疗检索**：针对“今天吃什么”等时效性问题，系统会自动结合“节气 + 地域”进行 RAG 检索和网络搜索。
- **[优化] AI 提示词**：强化了倪师风格，要求 AI 优先结合当前时令提供养生建议。

### v1.2.0 (2026-01-06) - 用户体验与持久化增强
- **[新增] 聊天记录持久化**：对话内容自动保存至浏览器 `localStorage`，刷新页面不丢失。
- **[新增] 对话导出功能**：点击 ChatBox 右上角下载图标，可将当前对话导出为 `.txt` 文件。
- **[新增] 滚动交互优化**：支持连续对话时的上下拖动查看。
- **[新增] 网络搜索回退机制**：当 AI 服务连接不稳定时，系统会自动抓取网络实时信息作为参考回复。
- **[优化] 超时控制**：后端请求增加 60s 超时保护，提升系统稳定性。

### v1.1.0 (2026-01-05) - RAG 核心系统上线
- **[新增] 多格式文献索引**：支持 `PDF`、`DOCX`、`EPUB` 格式的倪师著作自动索引。
- **[新增] 智能分块 (Chunking)**：采用 800 字符分块及 200 字符重叠策略，提升上下文检索精度。
- **[新增] RAG 命中日志**：后端实时打印检索匹配分值与来源，增强系统可观测性。

---

## 💡 核心功能说明

### 1. 对话倪师 (AI Chat)
- **入口**：点击页面右下角的聊天图标即可开启。
- **特性**：
    - **本源检索**：回答优先基于 `masterni/` 目录下的倪海厦原始文献。
    - **实时补充**：本地库无匹配时，系统会自动通过 DuckDuckGo 搜索中医相关实时资讯。
    - **时令建议**：主动识别当前节气，为您量身定制当下的养生方案。

### 2. 养生历 (Wellness Calendar)
- **展示**：首页展示 2026 年完整的二十四节气表。
- **详情**：点击具体节气可查看：
    - **饮食建议**：对应时节的推荐食材。
    - **经络穴位**：此时节重点保养的穴位。
    - **起居调理**：作息与运动指导。

### 3. 数据保存与导出
- **自动保存**：您的每一句对话都会实时保存在您的设备上。
- **手动导出**：点击聊天窗口右上角的 **“下载”** 图标，可保存为文本文件供日后查阅。

---

## 🛠️ 常见问题 (FAQ)

**Q: 为什么 AI 回复说“网络搜索暂不可用”？**
A: 这通常是由于后端服务器无法连接到搜索接口或 API 请求频率受限。系统会尝试提供基于本地库的回答。

**Q: 如何让 AI 知道我所在的城市？**
A: 您可以直接在对话中输入，例如：“我在杭州，今天推荐吃什么？”，AI 会自动识别并将杭州的气候背景纳入考量。

**Q: 聊天记录会占用很大空间吗？**
A: 不会。记录以文本形式保存在浏览器的 `localStorage` 中，通常仅占用几 KB 空间。若想清除，可直接清空浏览器缓存或在 ChatBox 中手动处理。

---

## 👨‍💻 开发者维护规范

为了确保项目的可维护性，请遵循以下流程：
1. **文档先行**：在执行 `git commit` 前，必须先更新 `README.md` 和本手册中的 **[版本更新日志]**。
2. **时空逻辑**：修改养生逻辑时，需同步测试 `server/utils.ts` 中的节气与位置感知函数。
3. **版本对齐**：每次重大功能更新需递增版本号（如 v1.0.0 -> v1.1.0）。

---

## 📝 版本更新日志

### v1.1.0 (2026-01-07)
*   **全局悬浮对话**：将 ChatBox 提升至全局 `App.tsx` 入口，确保其在所有页面和滚动状态下均能正确浮动。
*   **UI 布局重构**：根据用户审美需求，将“对话倪师”和“今天吃什么”按钮重定位至页面左上角（Logo 旁）。
*   **动态滚动感知**：新增滚动监听逻辑，使按钮样式能随导航栏背景自动切换，确保持续的视觉清晰度。
*   **交互优化**：移除了冗余的全局事件，优化了 `handleSend` 逻辑，实现点击即时推荐。

### v1.0.0
*   初始版本发布，集成 RAG 知识库与二十四节气养生建议。
